* ## 서블릿 예외 처리 시작

서블릿은 다음 2가지 방식으로 예외처리를 지원함
* `Exception` (예외) 
* `response.sendError`(HTTP 상태코드, 오류 메시지)

### Exception(예외)

* #### 자바 직접 실행
자바의 메인 메서드를 직접 실행하는 경우 main 이라는 이름의 쓰레드가 실행된다.

실행 도중에 예외를 잡지 못하고 처음 실행한 main() 메서드를 넘어서 예외가 던져지면, 

예외 정보를 남기고 해당 쓰레드는 종료된다.


* ####  웹 애플리케이션
웹 애플리케이션은 사용자 요청별로 별도의 쓰레드가 할당되고, 서블릿 컨테이너 안에서 실행된다.

애플리케이션에서 예외가 발생했는데, 어디선가 try ~ catch로 예외를 잡아서 처리하면 아무런 문제가
없다. 

그런데 만약에 애플리케이션에서 예외를 잡지 못하고, 서블릿 밖으로 까지 예외가 전달되면 어떻게
동작할까?

> WAS(여기까지 전파) <- 필터 <- 서블릿 <- 인터셉터 <- 컨트롤러(예외발생)
> 


* ### 서블릿 예외 처리 - 오류 페이지 작동원리
서블릿은 `Exception`이 발생해서 서블릿 밖으로 전달되거나 또는  `response.sendError()`가 호출 되었을때 설정된 오류 페이지를 찾는다.

* 예외 발생흐름
> was(여기까지 전파) <- 필터 <- 서블릿 <- 인터셉터 <- 컨트롤러(예외발생)

* sendError 흐름
> was(sendError 호출 기록 확인) <- 필터 <- 서블릿 <- 인터셉터 <- 컨트롤러(response.sendError())

WAS는 해당 예외를 처리하는 오류 페이지 정보를 확인한다.
```java
new ErrorPage(RuntimeException.class, "/error-page/500");
```
예를 들어서 `RuntimeException`예외가 WAS까지 전달되면, WAS는 오류 페이지 정보를 확인
`RuntimeException`의 오류페이지로 `/error-page/500`이 지정되어있다. WAS는 오류페이지를 출력하기 위해 `/error-page/500`을 다시 요청한다.

* 오류 페이지 요청 흐름
> WAS `/error-page/500` 다시요청 -> 필터 -> 서블릿 -> 인터셉터 -> 컨트롤러(/error-page/500) -> view


* 예외 발생과 오류 페이지 요청 흐름
> 1. WAS(여기까지 전파) <- 필터 <- 서블릿 <- 인터셉터 <- 컨트롤러(예외발생)
> 2. WAS `/error-page/500` 다시요청 -> 필터 -> 서블릿 -> 인터셉터 -> 컨트롤러(/error-page/500) -> view

* #### 중요한 점은 웹 브라우저(클라이언트)는 서버 내부에서 이런 일이 일어나는지 전혀 모른다. 오직 서버 내부에서 오류 페이지를 찾기 위해 추가적인 호출을 한다.



* ### 정리하면 다음과 같다.
1. 예외가 발생해서 WAS까지 전파된다.
2. WAS는 오류 페이지 경로를 찾아서 내부에서 오류 페이지를 호출한다. 이때 오류 페이지 경로로 필터,
   서블릿, 인터셉터, 컨트롤러가 모두 다시 호출된다.